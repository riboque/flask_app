<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Termos de Uso - Sistema de Monitoramento</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #ea6666 0%, #4ba254 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .terms-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            padding: 40px;
            width: 100%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .terms-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .terms-header h2 {
            color: #333;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .terms-header p {
            color: #666;
            font-size: 14px;
        }
        .terms-content {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 4px solid #667eea;
            max-height: 300px;
            overflow-y: auto;
        }
        .terms-content h5 {
            color: #333;
            margin-bottom: 15px;
        }
        .terms-content ul {
            padding-left: 20px;
        }
        .terms-content li {
            margin-bottom: 8px;
            color: #555;
        }
        .checkbox-container {
            margin-bottom: 30px;
        }
        .form-check-input:checked {
            background-color: #667eea;
            border-color: #667eea;
        }
        .btn-accept {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            color: white;
            transition: transform 0.2s ease;
        }
        .btn-accept:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }
        .btn-accept:disabled {
            background: #6c757d;
            transform: none;
        }
        .alert {
            border-radius: 8px;
            border: none;
        }
        .user-info {
            background: #e7f3ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        .user-info h6 {
            margin-bottom: 10px;
            color: #333;
            font-weight: 600;
        }
        .user-info p {
            margin-bottom: 5px;
            font-size: 14px;
            color: #666;
        }
        .user-info code {
            background: #d1ecf1;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="terms-container">
        <div class="terms-header">
            <h2>üìã Termos de Uso</h2>
            <p>Por favor, leia e aceite os termos para continuar</p>
        </div>

        <div class="user-info">
            <h6>üîç Informa√ß√µes do Usu√°rio</h6>
            <p><strong>ID do Usu√°rio:</strong> <code id="userId">Carregando...</code></p>
            <p><strong>Endere√ßo IP:</strong> <code id="userIp">Carregando...</code></p>
            <p><strong>Data/Hora:</strong> <code id="timestamp">Carregando...</code></p>
        </div>

        <div id="alertContainer"></div>

        <div class="terms-content">
            <h5>Termos de Uso do Sistema de Monitoramento</h5>
            <ul>
                <li>Ao aceitar estes termos, voc√™ concorda em fornecer suas informa√ß√µes de sistema para monitoramento.</li>
                <li>Ser√£o coletados dados como: hostname, sistema operacional, IP local, uso de recursos e conex√µes de rede.</li>
                <li>Seus dados ser√£o utilizados apenas para fins de monitoramento e an√°lise do sistema.</li>
                <li>Voc√™ pode acessar o chat em tempo real ap√≥s aceitar os termos.</li>
                <li>O sistema ir√° autenticar automaticamente voc√™ usando seu ID e endere√ßo IP.</li>
                <li>Seus dados permanecer√£o confidenciais e ser√£o criptografados quando armazenados.</li>
                <li>Voc√™ pode solicitar a exclus√£o de seus dados a qualquer momento.</li>
            </ul>
        </div>

        <form id="termsForm">
            <div class="checkbox-container">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="acceptTerms" name="accept_terms" value="on" required>
                    <label class="form-check-label" for="acceptTerms">
                        <strong>Eu li e aceito os termos de uso acima</strong>
                    </label>
                </div>
            </div>

            <button type="submit" class="btn btn-accept" id="acceptBtn" disabled>
                ‚úÖ Aceitar Termos e Continuar
            </button>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Carregar informa√ß√µes do usu√°rio
        async function loadUserInfo() {
            try {
                const response = await fetch('/api/user_info');
                const data = await response.json();
                document.getElementById('userId').textContent = data.user_id;
                document.getElementById('userIp').textContent = data.ip;
                document.getElementById('timestamp').textContent = new Date().toLocaleString('pt-BR');
            } catch (error) {
                console.error('Erro ao carregar informa√ß√µes:', error);
                document.getElementById('userId').textContent = 'Erro ao carregar';
                document.getElementById('userIp').textContent = 'Erro ao carregar';
            }
        }

        // Mostrar alertas
        function showAlert(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.setAttribute('role', 'alert');
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            alertContainer.innerHTML = '';
            alertContainer.appendChild(alertDiv);

            if (type === 'success') {
                setTimeout(() => alertDiv.classList.remove('show'), 2000);
            }
        }

        // Habilitar/desabilitar bot√£o
        document.getElementById('acceptTerms').addEventListener('change', function() {
            document.getElementById('acceptBtn').disabled = !this.checked;
        });

        // Coletar informa√ß√µes do navegador/sistema do cliente
        async function collectClientSystemInfo() {
            const info = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                cookieEnabled: navigator.cookieEnabled,
                online: navigator.onLine,
                cores: navigator.hardwareConcurrency || 'N/A',
                memory: navigator.deviceMemory || 'N/A',
                screenWidth: screen.width,
                screenHeight: screen.height,
                colorDepth: screen.colorDepth,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                ipPublico: 'Buscando...'
            };
            
            // Tentar obter IP p√∫blico
            try {
                const ipResponse = await fetch('https://api.ipify.org?format=json', { timeout: 3000 });
                const ipData = await ipResponse.json();
                info.ipPublico = ipData.ip;
            } catch (e) {
                console.warn('N√£o foi poss√≠vel obter IP p√∫blico:', e);
                info.ipPublico = 'N/A';
            }
            
            return info;
        }

        // Submiss√£o do formul√°rio - COM COLETA DE DADOS DO SISTEMA
        document.getElementById('termsForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const acceptBtn = document.getElementById('acceptBtn');
            acceptBtn.disabled = true;
            acceptBtn.textContent = '‚è≥ Coletando informa√ß√µes...';

            try {
                // Coletar dados do sistema do cliente
                const systemInfo = await collectClientSystemInfo();
                acceptBtn.textContent = '‚è≥ Enviando dados...';
                
                // Enviar dados para o servidor COM informa√ß√µes do sistema
                const response = await fetch('/accept_terms', { 
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        accept_terms: true,
                        system_info: systemInfo
                    })
                });
                const data = await response.json();

                if (data.success && data.redirect) {
                    window.location.href = data.redirect;
                } else {
                    throw new Error(data.message || 'Erro ao aceitar termos');
                }

            } catch (error) {
                console.error('Erro ao aceitar termos:', error);
                showAlert('‚ùå Erro: ' + error.message + '. Tente novamente.', 'danger');
                acceptBtn.disabled = false;
                acceptBtn.textContent = '‚úÖ Aceitar Termos e Continuar';
            }
        });

        // Inicializar
        document.addEventListener('DOMContentLoaded', loadUserInfo);
    </script>
</body>
</html>